# Isochron Watch Cleaner - AC Motor Configuration
#
# Example configuration for machines using AC motors with relay control.
# Common for industrial retrofits or repurposed ultrasonic cleaners.
#
# AC motors are controlled via relay modules (solid state or mechanical).
# Speed control is NOT available - AC motors run at fixed speed.
#
# WARNING: AC mains voltage is dangerous. Ensure proper isolation,
# grounding, and safety interlocks. Use SSRs rated for your voltage.
#
# Usage:
#   cp examples/ac-motor.toml machine.toml
#   cargo build --release

[machine]
version = 1
motor_type = "ac"  # dc, ac, or stepper

# =============================================================================
# AC MOTORS
# =============================================================================
# Motor to board connector mapping (BTT SKR Pico):
#   basket → E slot (GPIO 14, 13, 15)
#   x      → X slot (GPIO 11, 10, 12)
#   z      → Z slot (GPIO 19, 28, 2)
#   lid    → Y slot (GPIO 6, 5, 7)

[ac_motor.basket]
enable_pin = "gpio14"           # Relay control (E connector)
direction_pin = "gpio13"        # For reversible motors (optional)
relay_type = "ssr"              # ssr (solid state) or mechanical
active_high = true              # Relay activation polarity

# Optional: Z axis (lift) - uncomment to enable
# [ac_motor.z]
# enable_pin = "gpio19"           # Z connector
# relay_type = "mechanical"
# active_high = true
# # Limit switches for safety
# endstop_up = "^gpio25"
# endstop_down = "^gpio3"

# Optional: X axis (carousel) - uncomment to enable
# [ac_motor.x]
# enable_pin = "gpio11"           # X connector
# direction_pin = "gpio10"
# relay_type = "ssr"
# active_high = true
# endstop_home = "^gpio4"

# =============================================================================
# SAFETY SETTINGS
# =============================================================================

[ac_safety]
min_switch_delay_ms = 100       # Minimum delay between relay toggles
interlock_enabled = true        # Prevent multiple motors running simultaneously
voltage = 120                   # For documentation/safety labels (120 or 240)

# =============================================================================
# HEATERS
# =============================================================================

[heater.dryer]
heater_pin = "gpio23"
sensor_pin = "gpio27"
sensor_type = "ntc100k"
control = "bang_bang"
max_temp = 55
hysteresis = 2

# =============================================================================
# JARS
# =============================================================================

[jar.clean]
x_pos = 0
z_pos = 120

[jar.rinse1]
x_pos = 90
z_pos = 120

[jar.rinse2]
x_pos = 180
z_pos = 120

[jar.dry]
x_pos = 270
z_pos = 100
heater = "dryer"

# =============================================================================
# PROFILES (AC motor version)
# =============================================================================
# Note: AC motors have no speed control - they run at fixed speed.
# The 'rpm' and 'speed' fields are ignored for AC motors.

[profile.clean]
label = "Clean"
time_s = 180
direction = "alternate"
iterations = 3

[profile.rinse]
label = "Rinse"
time_s = 120
direction = "cw"
iterations = 1

[profile.dry]
label = "Dry"
time_s = 600
direction = "alternate"
iterations = 6
temperature_c = 45

# =============================================================================
# PROGRAMS
# =============================================================================

[program.full_clean]
label = "Full Clean"
steps = [
    { jar = "clean", profile = "clean" },
    { jar = "rinse1", profile = "rinse" },
    { jar = "rinse2", profile = "rinse" },
    { jar = "dry", profile = "dry" },
]

[program.quick_clean]
label = "Quick Clean"
steps = [
    { jar = "clean", profile = "clean" },
    { jar = "rinse1", profile = "rinse" },
]

[program.dry_only]
label = "Dry Only"
steps = [
    { jar = "dry", profile = "dry" },
]

# =============================================================================
# DISPLAY
# =============================================================================

[display]
type = "v0_display"
uart_tx_pin = "gpio0"
uart_rx_pin = "gpio1"
baud = 115200
