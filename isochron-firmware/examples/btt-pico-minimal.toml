# Isochron Watch Cleaner - BTT SKR Pico Minimal Configuration
#
# Minimal config for a basic manual cleaning machine:
# - Single basket motor (stepper with TMC2209)
# - Dryer heater with thermistor
# - 4 jars: clean, rinse1, rinse2, dry
# - V0 display for user interface
#
# This is the simplest working configuration. For automated machines
# with lift/carousel motors, see btt-pico.toml.
#
# Usage:
#   cp examples/btt-pico-minimal.toml machine.toml
#   cargo build --release

[machine]
version = 1

# =============================================================================
# BASKET MOTOR
# =============================================================================
# Uses E connector on BTT SKR Pico (GPIO 14, 13, 15)

[stepper.basket]
step_pin = "gpio14"
dir_pin = "gpio13"
enable_pin = "!gpio15"
rotation_distance = 360
gear_ratio = "3:1"
full_steps_per_rotation = 200
microsteps = 16

[tmc2209.basket]
uart_address = 3
run_current = 800
hold_current = 400
stealthchop = true

# =============================================================================
# DRYER HEATER
# =============================================================================
# Uses HE0 output (GPIO 23) and TH0 thermistor (GPIO 27)

[heater.dryer]
heater_pin = "gpio23"
sensor_pin = "gpio27"
sensor_type = "ntc100k"
control = "bang_bang"
max_temp = 55
hysteresis = 2

# =============================================================================
# JARS
# =============================================================================

[jar.clean]
x_pos = 0
z_pos = 120

[jar.rinse1]
x_pos = 90
z_pos = 120

[jar.rinse2]
x_pos = 180
z_pos = 120

[jar.dry]
x_pos = 270
z_pos = 100
heater = "dryer"

# =============================================================================
# PROFILES
# =============================================================================

[profile.clean]
label = "Clean"
rpm = 120
time_s = 180
direction = "alternate"
iterations = 3

[profile.rinse]
label = "Rinse"
rpm = 100
time_s = 120
direction = "cw"
iterations = 1

[profile.dry]
label = "Dry"
rpm = 60
time_s = 600
direction = "alternate"
iterations = 6
temperature_c = 45

# =============================================================================
# PROGRAMS
# =============================================================================

[program.full_clean]
label = "Full Clean"
steps = [
    { jar = "clean", profile = "clean" },
    { jar = "rinse1", profile = "rinse" },
    { jar = "rinse2", profile = "rinse" },
    { jar = "dry", profile = "dry" },
]

[program.quick_clean]
label = "Quick Clean"
steps = [
    { jar = "clean", profile = "clean" },
    { jar = "rinse1", profile = "rinse" },
]

[program.dry_only]
label = "Dry Only"
steps = [
    { jar = "dry", profile = "dry" },
]

# =============================================================================
# DISPLAY
# =============================================================================

[display]
type = "v0_display"
uart_tx_pin = "gpio0"
uart_rx_pin = "gpio1"
baud = 115200
