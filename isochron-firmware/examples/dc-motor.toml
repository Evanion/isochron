# Isochron Watch Cleaner - DC Motor Configuration
#
# Example configuration for machines using DC motors.
# Simpler and more affordable than stepper-based builds.
#
# DC motors are controlled via PWM through H-bridge or MOSFET drivers.
# Speed is controlled as percentage (0-100%) rather than RPM.
#
# Usage:
#   cp examples/dc-motor.toml machine.toml
#   cargo build --release

[machine]
version = 1
motor_type = "dc"  # dc, ac, or stepper

# =============================================================================
# DC MOTORS
# =============================================================================
# Motor to board connector mapping (BTT SKR Pico):
#   basket → E slot (GPIO 14, 13, 15)
#   x      → X slot (GPIO 11, 10, 12)
#   z      → Z slot (GPIO 19, 28, 2)
#   lid    → Y slot (GPIO 6, 5, 7)

[dc_motor.basket]
pwm_pin = "gpio14"           # PWM speed control (E connector)
dir_pin = "gpio13"           # Direction (for H-bridge)
enable_pin = "!gpio15"       # Enable (active low)
driver_type = "h_bridge"     # h_bridge, mosfet, or dual_mosfet
pwm_frequency = 25000        # Hz
min_duty = 20                # % minimum for motor to start
soft_start_ms = 500          # ms to ramp up
soft_stop_ms = 300           # ms to ramp down

# Optional: Z axis (lift) - uncomment to enable
# [dc_motor.z]
# pwm_pin = "gpio19"           # Z connector
# dir_pin = "gpio28"
# enable_pin = "!gpio2"
# driver_type = "h_bridge"
# pwm_frequency = 25000
# min_duty = 30
# soft_start_ms = 200
# soft_stop_ms = 200
# # Limit switches for safety
# endstop_up = "^gpio25"
# endstop_down = "^gpio3"
# # Position limits (Klipper-style)
# position_min = 0             # mm
# position_max = 150           # mm max travel
# position_endstop = 0         # mm at endstop

# Optional: X axis (carousel) - uncomment to enable
# [dc_motor.x]
# pwm_pin = "gpio11"           # X connector
# dir_pin = "gpio10"
# enable_pin = "!gpio12"
# driver_type = "h_bridge"
# pwm_frequency = 25000
# min_duty = 25
# soft_start_ms = 300
# soft_stop_ms = 300
# endstop_home = "^gpio4"
# # Position limits (Klipper-style)
# position_min = 0             # mm
# position_max = 800           # mm (set based on your carousel size)
# position_endstop = 0         # mm at endstop

# =============================================================================
# HEATERS
# =============================================================================

[heater.dryer]
heater_pin = "gpio23"
sensor_pin = "gpio27"
sensor_type = "ntc100k"
control = "bang_bang"
max_temp = 55
hysteresis = 2

# =============================================================================
# JARS
# =============================================================================
# x_pos/z_pos are in mm. For rotary carousels, x_pos is arc distance from home.

[jar.clean]
x_pos = 0
z_pos = 120

[jar.rinse1]
x_pos = 200
z_pos = 120

[jar.rinse2]
x_pos = 400
z_pos = 120

[jar.dry]
x_pos = 600
z_pos = 100
heater = "dryer"

# =============================================================================
# PROFILES (DC motor version)
# =============================================================================
# Note: DC motors use percentage speed (0-100) instead of RPM

[profile.clean]
label = "Clean"
speed = 80                   # % of max speed
time_s = 180
direction = "alternate"
iterations = 3

[profile.rinse]
label = "Rinse"
speed = 70
time_s = 120
direction = "cw"
iterations = 1

[profile.dry]
label = "Dry"
speed = 50
time_s = 600
direction = "alternate"
iterations = 6
temperature_c = 45

# =============================================================================
# PROGRAMS
# =============================================================================

[program.full_clean]
label = "Full Clean"
steps = [
    { jar = "clean", profile = "clean" },
    { jar = "rinse1", profile = "rinse" },
    { jar = "rinse2", profile = "rinse" },
    { jar = "dry", profile = "dry" },
]

[program.quick_clean]
label = "Quick Clean"
steps = [
    { jar = "clean", profile = "clean" },
    { jar = "rinse1", profile = "rinse" },
]

[program.dry_only]
label = "Dry Only"
steps = [
    { jar = "dry", profile = "dry" },
]

# =============================================================================
# DISPLAY
# =============================================================================

[display]
type = "v0_display"
uart_tx_pin = "gpio0"
uart_rx_pin = "gpio1"
baud = 115200
